<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mis Proyectos</title>

  <!-- Mantengo tu hoja de estilos -->
  <link rel="stylesheet" href="css/styles.css" />
  <script src="https://code.iconify.design/iconify-icon/2.1.0/iconify-icon.min.js"></script>

</head>
<body>
  <!-- Mantengo estructura y diseño general -->
  <aside class="sidebar">
    <div class="photo-container">
      <img src="1.png" alt="Foto de perfil" class="profile-photo" />
    </div>
    <nav class="links">
      <a href="index.html" class="btn" target="_blank" rel="noopener noreferrer">Página web</a>
      <a href="https://wa.me/573108195437" class="btn" target="_blank" rel="noopener noreferrer">WhatsApp</a>
      <a href="https://linkedin.com/in/nalejob" class="btn" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </nav>
  </aside>

  <main class="main-content">
    <h1>Mis Proyectos</h1>

    <div class="filter-container">
      <!-- (1) Invertir ubicación: Año primero a la izquierda -->
      <div>
        <label for="year-select">Año</label>
        <select id="year-select">
          <option value="">— Selecciona —</option>
        </select>
      </div>

      <!-- (2) Nombre del proyecto oculto inicialmente -->
      <div id="project-block" style="display:none;">
        <label for="project-select">Nombre del proyecto</label>
        <select id="project-select" disabled>
          <option value="">— Selecciona —</option>
        </select>
      </div>
    </div>

    <!-- (3) Mostrar información SOLO cuando ambos dropdowns tengan selección -->
    <div class="project-detail">
      <div class="detail-box">
        <h2>Contexto Caso de Uso</h2>
        <p id="detail-context"></p>
      </div>
      <div class="detail-box">
        <h2>Problema</h2>
        <p id="detail-problema"></p>
      </div>
      <div class="detail-box">
        <h2>Herramientas</h2>
        <p id="detail-herramientas"></p>
      </div>
      <div class="detail-box">
        <h2>Habilidades</h2>
        <p id="detail-habilidades"></p>
      </div>
      <div class="detail-box">
        <h2>Resultados</h2>
        <p id="detail-resultados"></p>
      </div>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Carga el JSON de detalle
      fetch('DetallePortafolio.json')
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status} – ${response.statusText}`);
          return response.json();
        })
        .then(proyectos => {
          const selYear = document.getElementById('year-select');
          const selProj = document.getElementById('project-select');
          const projectBlock = document.getElementById('project-block');

          // (1) Poblar AÑOS (únicos) en orden descendente
          const aniosUnicos = [...new Set(proyectos.map(p => p['Año']))].sort((a, b) => b - a);
          aniosUnicos.forEach(y => selYear.add(new Option(String(y), String(y))));

          // (2) Al cambiar año: mostrar bloque de proyecto y poblar SOLO proyectos del año
          selYear.addEventListener('change', () => {
            const year = selYear.value;
            clearDetails();

            // Reset de proyectos
            selProj.innerHTML = '';
            selProj.add(new Option('— Selecciona —', ''));

            if (!year) {
              // Sin año => ocultar bloque proyectos y deshabilitar
              projectBlock.style.display = 'none';
              selProj.disabled = true;
              return;
            }

            // Filtrar proyectos por año y poblar nombres
            const proyectosAño = proyectos.filter(p => String(p['Año']) === year);
            const nombresUnicos = [...new Set(proyectosAño.map(p => p.Proyecto))].sort();
            nombresUnicos.forEach(nombre => selProj.add(new Option(nombre, nombre)));

            // Mostrar bloque proyectos y habilitar
            projectBlock.style.display = '';
            selProj.disabled = false;
          });

          // (3) Al cambiar proyecto: solo mostrar info si hay año + proyecto
          selProj.addEventListener('change', () => {
            const year = selYear.value;
            const name = selProj.value;

            if (!year || !name) {
              clearDetails();
              return;
            }

            const match = proyectos.find(p => p.Proyecto === name && String(p['Año']) === year);
            if (!match) {
              clearDetails();
              return;
            }

            setDetails(match);
          });
        // --- PARSEAR "clave:valor; clave:valor" ---
        function parseHerramientas(txt) {
          if (!txt) return [];
          return txt
            .split(/;|\n|,/g)
            .map(s => s.trim())
            .filter(Boolean)
            .map(pair => {
              const [k, ...rest] = pair.split(':');
              return { key: (k || '').trim(), value: (rest.join(':') || '').trim() };
            });
        }
      
        // --- MAPA DE ICONOS (Simple Icons + MDI como genéricos) ---
        // Si una clave no está mapeada, se usa GENÉRICO.
        const GENERIC_ICON = 'mdi:toolbox-outline';
        const ICONS = {
          'Python': 'simple-icons:python',
          'Power BI': 'simple-icons:powerbi',
          'Power Query': 'simple-icons:powerquery',
          'Power Automate': 'simple-icons:powerautomate',
          'SQL': 'mdi:database',
          'PostgreSQL': 'simple-icons:postgresql',
          'MySQL': 'simple-icons:mysql',
          'MongoDB': 'simple-icons:mongodb',
          'Excel': 'simple-icons:microsoftexcel',
          'Tableau': 'simple-icons:tableau',
          'Git': 'simple-icons:git',
          'GitHub': 'simple-icons:github',
          'Docker': 'simple-icons:docker',
          'AWS': 'simple-icons:amazonaws',
          'GCP': 'simple-icons:googlecloud',
          'Azure': 'simple-icons:microsoftazure',
          'R': 'simple-icons:r',
          'Apache Spark': 'simple-icons:apachespark',
          'Spark': 'simple-icons:apachespark',
          'Apache Airflow': 'simple-icons:apacheairflow',
          'Airflow': 'simple-icons:apacheairflow',
          'D3.js': 'simple-icons:d3dotjs',
          'React': 'simple-icons:react',
          'Node.js': 'simple-icons:nodedotjs',
          'Linux': 'simple-icons:linux',
          'Figma': 'simple-icons:figma'
        };
      
        // --- RENDERIZAR ICONOS EN #detail-herramientas ---
        function renderHerramientasIconify(txt) {
          const host = document.getElementById('detail-herramientas');
          host.innerHTML = ''; // Limpia lo anterior
      
          const items = parseHerramientas(txt);
          items.forEach(({ key, value }) => {
            const wrap = document.createElement('span');
            wrap.className = 'tool-chip';
            const tip = `${key}${value ? ': ' + value : ''}`;
            wrap.title = tip;
            wrap.setAttribute('aria-label', tip);
      
            const ic = document.createElement('iconify-icon');
            ic.setAttribute('icon', ICONS[key] || GENERIC_ICON);
      
            wrap.appendChild(ic);
            host.appendChild(wrap);
          });
        }
          function setDetails(item) {
            document.getElementById('detail-context').innerText       = item['Contexto Caso de Uso'] || '';
            document.getElementById('detail-problema').innerText      = item['Problema'] || '';
            renderHerramientasIconify(match['Herramientas']);
            document.getElementById('detail-habilidades').innerText   = item['Habilidades'] || '';
            document.getElementById('detail-resultados').innerText    = item['Resultados'] || '';
          }

          function clearDetails() {
            ['detail-context','detail-problema','detail-herramientas','detail-habilidades','detail-resultados']
              .forEach(id => document.getElementById(id).innerText = '');
          }
        })
        .catch(err => {
          console.error('Error cargando datos de proyectos:', err);
          document.querySelector('.main-content').insertAdjacentHTML(
            'beforeend',
            '<p style="color:red;">No se pudo cargar la lista de proyectos.</p>'
          );
        });
    });
  </script>
</body>
</html>

